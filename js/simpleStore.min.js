/* simplestore | Copyright 2017 Chris Diana (https://github.com/cdmedia/simplestore) | MIT license | v1.5 */

var simpleStore={products:[],plugins:{},settings:{numColumns:3,brand:"SimpleStore",mode:"JSON",JSONFile:"products.json",fadeSpeed:200,buttonColor:null,backgroundColor:null,textColor:null,container:$(".simpleStore_container"),cartContainer:$(".simpleStore_cart_container"),rowClass:"simpleStore_row_",columnWidthClasses:{1:"",2:"one-half",3:"one-third"}},productPageOptions:["OneOfAKind"],extend:function(e,t,n){var r;void 0===t&&(t=e,e=simpleStore);for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return n(),e},render:function(e,t){var n=e.split("/")[0],r={"":function(){simpleStore.renderProducts(simpleStore.products,t)},"#product":function(){var n=e.split("#product/")[1].trim();simpleStore.renderSingleProduct(n,t)},"#cart":function(){simpleStore.renderCart(t)}};r[n]?r[n]():simpleStore.renderError(t)},insertData:function(e,t){e.find(".item_thumb").attr("src",t.image),e.find(".item_name").text(t.name),e.find(".item_price").text(t.price),e.find(".item_description").text(t.description)},renderProducts:function(e,t){var n,r=1,i=(e.length,Math.ceil(e.length/t.numColumns));t.cartContainer.hide(),t.container.fadeOut(t.fadeSpeed,function(){t.container.html("").fadeIn(t.fadeSpeed);for(var o=0;o<i;o++)t.container.append('<div class="row '+t.rowClass+(o+1)+'"></div>');var a=t.columnWidthClasses;for(var l in a)l==t.numColumns&&(n=a[l]);e.forEach(function(e,i){if(!e.soldOut){var o=$("#products-template").html(),a=$(o);a.first().addClass(n),simpleStore.insertData(a,e),a.find(".simpleStore_getDetail").on("click",function(t){t.preventDefault(),window.location.hash="product/"+e.id}),0===i&&(i=1),i%t.numColumns==0&&r++,$("."+t.rowClass+r).append(a)}})})},renderProductOptions:function(e,t){var n="";return e.forEach(function(t){if(simpleStore.productPageOptions in t)simpleStore.renderProductPageOptions(t);else{var r="",i=Object.keys(t)[0].trim(),o=t[i].trim().split(",");$(o).each(function(e,t){r+='<option value="'+t.replace(/ /g,"_").toLowerCase()+'"> '+t+" </option>"}),e.length&&(n+="<label>"+i+'</label><select class="item_'+i.replace(/ /g,"_").toLowerCase()+'">'+r+"</select>")}}),n},renderProductPageOptions:function(e){e.OneOfAKind&&$(".qty").hide()},renderSingleProduct:function(e,t){t.container.fadeOut(t.fadeSpeed,function(){var n=$("#product-detail-template").html(),r=$(n);simpleStore.products.forEach(function(n){if(n.id==e){if(simpleStore.insertData(r,n),t.container.html(r),n.options.length){var i=simpleStore.renderProductOptions(n.options,t);$(".simpleStore_options").append(i)}t.container.fadeIn(t.fadeSpeed)}})})},renderCart:function(e){e.container.fadeOut(e.fadeSpeed,function(){e.cartContainer.fadeIn(e.fadeSpeed)})},renderError:function(e,t){var n=$("#error-template").html(),r=$(n);e.container.html("").fadeIn(e.fadeSpeed),t.length&&r.find(".error_text").text(t),e.container.append(r),e.container.fadeIn(e.fadeSpeed),r.find(".alert_close").on("click",function(t){t.preventDefault(),r.fadeOut(e.fadeSpeed,function(){r.remove()})})},handleFailure:function(e,t){setTimeout(function(){simpleStore.renderError(e,t)},1e3)},notifier:function(e){s=this.settings;var t=$("#notify-template").html(),n=$(t);e.length&&(n.find(".notify_text").text(e),s.container.append(n),n.hide(),n.fadeIn(s.fadeSpeed),setTimeout(function(){n.fadeOut(s.fadeSpeed)},1e3))},initJSON:function(e){var t='There was an error loading the JSON file. Please make sure you have "'+e.JSONFile+'" file in your main directory.';$.get(e.JSONFile).success(function(){$.getJSON(e.JSONFile,function(e){simpleStore.setProducts(e.products)}).fail(function(){simpleStore.handleFailure(e,t)})}).fail(function(){simpleStore.handleFailure(e,t)})},checkMode:function(e){(e.hasOwnProperty("spreadsheetID")||e.hasOwnProperty("spreadsheetId"))&&(e.mode="Google")},checkout:function(e,t){$.isEmptyObject(t)||(simpleCart.checkout(),e.cartContainer.fadeOut(e.fadeSpeed,function(){e.container.html('<i class="fa fa-spin fa-circle-o-notch loader"></i>'),e.container.fadeIn(e.fadeSpeed)}))},verifyCheckoutData:function(e,t,n){for(var r in e)if(e.hasOwnProperty(r))for(var i=e[r],o=i.name,a=i.price,l=0;l<t.length;l++){var s=t[l],c=s.name,d=s.price;o===c&&a!=d&&(n=!1)}return n},validatePrices:function(e){var t=JSON.parse(localStorage.simpleCart_items),n="There was an error validating your cart.";if("JSON"===e.mode)$.get(e.JSONFile).success(function(){$.getJSON(e.JSONFile,function(r){var i=r.products;simpleStore.verifyCheckoutData(t,i,!0)?simpleStore.checkout(e,t):simpleStore.renderError(e,n)}).fail(function(){simpleStore.handleFailure(e,n)})}).fail(function(){simpleStore.handleFailure(e,n)});else{var r=e.mode.toLowerCase();simpleStore.plugins[r]&&simpleStore.plugins[r].validate(t)}},setProducts:function(e,t){e.length>0&&e.forEach(function(e,t){e.id=t+1,simpleStore.products.push(e)}),$(window).trigger("hashchange")},setLayout:function(e){e.brand.match("^http://")||e.brand.match("^https://")||e.brand.match("^www.")?$(".brand").html('<img src="'+e.brand+'" />'):$(".brand").html("<h5>"+e.brand+"</h5>"),$("title").html(e.brand)},generateCart:function(e){var t=$("#cart-template").html(),n=$(t);e.cartContainer.html(n)},generateStore:function(){var e=this.settings;switch(this.checkMode(e),$(window).on("hashchange",function(){simpleStore.render(window.location.hash,e)}),e.mode){case"JSON":this.initJSON(e);break;case"Google":if(simpleStore.plugins.google)simpleStore.plugins.google.init(function(t){simpleStore.setProducts(t,e)});else{simpleStore.renderError(e,"There was an error loading the Google plugin. Make sure it is installed properly.")}break;default:this.initJSON(e)}this.generateCart(e),this.setLayout(e),$(".simpleStore_checkout").on("click",function(t){t.preventDefault(),simpleStore.validatePrices(e)}),$(".simpleStore_viewCart").on("click",function(e){e.preventDefault(),window.location="#cart"}),$(".view_close").on("click",function(e){e.preventDefault(),window.location.hash=""}),simpleCart({afterAdd:function(){simpleStore.notifier("Item added to cart")}})},init:function(e){if($.isPlainObject(e))return this.extend(this.settings,e,function(){simpleStore.generateStore()})}};